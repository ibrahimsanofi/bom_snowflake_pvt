<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Pivot Test</title>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .value-cell { text-align: right; }
        .non-zero-value { font-weight: bold; }
    </style>
</head>
<body>
    <h1>Simple Pivot Test</h1>
    <div id="pivotTable"></div>

    <script>
        // Sample data structure
        const testData = [
            { LE: "LE1", COST_UNIT: 1234.56 },
            { LE: "LE2", COST_UNIT: 2345.67 },
            { LE: "LE3", COST_UNIT: 3456.78 }
        ];
        
        // Simple pivot structure
        const pivotData = {
            rows: [
                { _id: "row1", label: "LE1", factId: "LE1" },
                { _id: "row2", label: "LE2", factId: "LE2" },
                { _id: "row3", label: "LE3", factId: "LE3" }
            ],
            data: [
                { _id: "row1", "COST_UNIT": 1234.56 },
                { _id: "row2", "COST_UNIT": 2345.67 },
                { _id: "row3", "COST_UNIT": 3456.78 }
            ]
        };
        
        function renderCell(value) {
            // Force number conversion
            let numericValue = typeof value === 'number' ? value : parseFloat(String(value) || '0');
            if (isNaN(numericValue)) numericValue = 0;
            
            // Format for display
            let formattedValue;
            if (numericValue === 0) {
                formattedValue = '0.00';
            } else if (Math.abs(numericValue) >= 1000000) {
                formattedValue = (numericValue / 1000000).toFixed(2) + 'm';
            } else if (Math.abs(numericValue) >= 1000) {
                formattedValue = (numericValue / 1000).toFixed(2) + 'k';
            } else {
                formattedValue = numericValue.toFixed(2);
            }
            
            // Add class based on value
            const cellClass = numericValue !== 0 ? 'value-cell non-zero-value' : 'value-cell';
            
            return `<td class="${cellClass}">${formattedValue}</td>`;
        }
        
        function renderPivotTable() {
            const tableContainer = document.getElementById('pivotTable');
            
            let tableHtml = '<table>';
            
            // Header
            tableHtml += '<tr><th>Hierarchy</th><th>Value - Cost Unit</th></tr>';
            
            // Rows
            pivotData.rows.forEach((row, index) => {
                const dataRow = pivotData.data.find(d => d._id === row._id);
                
                tableHtml += '<tr>';
                tableHtml += `<td>${row.label}</td>`;
                tableHtml += renderCell(dataRow ? dataRow.COST_UNIT : 0);
                tableHtml += '</tr>';
            });
            
            tableHtml += '</table>';
            
            tableContainer.innerHTML = tableHtml;
            
            // Log the raw data for comparison
            console.log("Pivot data:", pivotData.data);
        }
        
        // Initialize
        renderPivotTable();
    </script>
</body>
</html>